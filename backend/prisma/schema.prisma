// AfriLaunch Hub - Database Schema (PostgreSQL)
// Matches specs: Users, Clients, Projects, Tasks, Messages, Files, Payments, Reports, Maintenance, Agreements

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Core roles for hiring/talent: talent, hiring_company, hr_manager, legal_team, super_admin, cofounder
// Legacy: client, developer, designer, marketer, project_manager, finance_admin, investor, hirer (alias hiring_company)
enum UserRole {
  client
  developer
  designer
  marketer
  project_manager
  finance_admin
  super_admin
  investor
  talent
  hirer           // same as hiring_company
  hiring_company  // alias for hirer (spec naming)
  hr_manager
  legal_team
  cofounder       // talent approval, marketplace moderation
}

enum ProjectStage {
  Planning
  Development
  Testing
  Live
}

// Project status flow: Idea Submitted → Review → Proposal → Dev → Testing → Live → Maintenance
enum ProjectStatus {
  IdeaSubmitted
  ReviewValidation
  ProposalSent
  Development
  Testing
  Live
  Maintenance
}

enum MilestoneStatus {
  Pending
  InProgress
  Completed
}

enum TaskPriority {
  Low
  Medium
  High
}

enum TaskStatus {
  Todo
  InProgress
  Done
  Blocked
}

enum PaymentStatus {
  Paid
  Pending
}

enum AgreementType {
  NDA
  MOU
  CoFounder
  Terms
  FairTreatment
  HireContract
  Partnership
  Investor
}

// Document-level status: Pending until all signers have signed, then Completed
enum AgreementDocumentStatus {
  Pending
  Completed
}

enum AssignedAgreementStatus {
  Draft    // company drafts contract
  Pending  // awaiting signature
  Signed   // both signed
  Overdue  // past deadline
  Disputed // legal team monitors
}

// Multi-tenant white-label
enum TenantPlanType {
  free
  starter
  growth
  enterprise
}

model Tenant {
  id           String        @id @default(uuid())
  orgName      String        @map("org_name")
  domain       String?       @unique  // custom domain e.g. app.acme.com
  logo         String?       // URL or path
  primaryColor String?       @map("primary_color") @db.VarChar(20) // e.g. #6366f1
  planType     TenantPlanType @default(free) @map("plan_type")
  createdAt    DateTime      @default(now()) @map("created_at")
  updatedAt    DateTime      @updatedAt @map("updated_at")

  users   User[]
  billing TenantBilling[]
}

model TenantBilling {
  id         String   @id @default(uuid())
  tenantId   String   @map("tenant_id")
  periodStart DateTime @map("period_start") @db.Date
  periodEnd   DateTime @map("period_end") @db.Date
  amount     Decimal  @db.Decimal(12, 2)
  status     String   @default("pending") // pending | paid
  createdAt  DateTime @default(now()) @map("created_at")

  tenant Tenant @relation(fields: [tenantId], references: [id], onDelete: Cascade)
}

model User {
  id              String    @id @default(uuid())
  tenantId        String?   @map("tenant_id")
  name            String    // full_name in spec (stored as name)
  email           String    @unique
  passwordHash    String    @map("password_hash")
  role            UserRole  @default(client)
  country         String?   @db.VarChar(100)
  phone           String?   @db.VarChar(50)
  verified        Boolean   @default(false)
  setupPaid       Boolean   @default(false) @map("setup_paid")
  setupReason     String?   @map("setup_reason") @db.VarChar(100) // skip reason: cant_afford | pay_later | exploring | other
  avatarUrl       String?   @map("avatar_url")
  lastLoginAt     DateTime? @map("last_login_at")
  welcomePanelSeen Boolean   @default(false) @map("welcome_panel_seen")
  customRoleId    String?   @map("custom_role_id")
  createdAt       DateTime  @default(now()) @map("created_at")
  updatedAt       DateTime  @updatedAt @map("updated_at")

  tenant            Tenant?   @relation(fields: [tenantId], references: [id], onDelete: SetNull)
  customRole        CustomRole? @relation(fields: [customRoleId], references: [id], onDelete: SetNull)
  client            Client?
  investor          Investor?
  assignedTasks     Task[]           @relation("AssignedTasks")
  sentMessages       Message[]         @relation("SentMessages")
  uploadedFiles      File[]           @relation("UploadedFiles")
  dealRoomMessagesSent DealRoomMessage[] @relation("DealRoomMessageSender")
  assignedAgreements AssignedAgreement[]
  adminLeadsAssigned AdminLead[]     @relation("AdminLeadsAssigned")
  adminLeadNotes    AdminLeadNote[]
  userPayments      UserPayment[]
  auditLogsCreated  AuditLog[]    @relation("AuditLogAdmin")
  teamInvitesSent   TeamInvite[]   @relation("TeamInvitesSent")
  projectMemberships ProjectMember[]
  cmsContentUpdated CmsContent[]
  talentProfile     Talent?
  hirerProfile      Hirer?
  talentRatingsGiven   TalentRating[] @relation("TalentRatingFrom")
  talentRatingsReceived TalentRating[] @relation("TalentRatingTo")
  notifications     Notification[]
  agreementsCreated Agreement[]   @relation("AgreementCreatedBy")
  aiConversations   AiConversation[]
  aiGeneratedOutputs AiGeneratedOutput[]
}

// Custom roles (Super Admin can add); display name + department
model CustomRole {
  id          String       @id @default(uuid())
  name        String       // e.g. "Brand Designer"
  department  String?      @db.VarChar(100)
  level       String?      @db.VarChar(50) // e.g. "Level 3"
  createdAt   DateTime     @default(now()) @map("created_at")

  users       User[]
  teamInvites TeamInvite[]
}

// Team invite (Super Admin sends; invitee sets password via link)
model TeamInvite {
  id           String    @id @default(uuid())
  email        String
  role         String    @db.VarChar(50) // UserRole value for system role
  customRoleId String?   @map("custom_role_id")
  token        String    @unique
  expiresAt    DateTime  @map("expires_at")
  invitedById  String    @map("invited_by_id")
  createdAt    DateTime  @default(now()) @map("created_at")

  invitedBy    User      @relation("TeamInvitesSent", fields: [invitedById], references: [id], onDelete: Cascade)
  customRole   CustomRole? @relation(fields: [customRoleId], references: [id], onDelete: SetNull)
}

model Client {
  id            String   @id @default(uuid())
  userId        String   @unique @map("user_id")
  businessName  String   @map("business_name")
  industry      String?
  ideaSummary   String?  @map("idea_summary") @db.Text
  budgetRange   String?  @map("budget_range")
  createdAt     DateTime @default(now()) @map("created_at")
  updatedAt     DateTime @updatedAt @map("updated_at")

  user     User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  projects Project[]
}

model Project {
  id              String         @id @default(uuid())
  clientId        String         @map("client_id")
  projectName     String         @map("project_name")
  description     String?        @db.Text
  tagline         String?        @db.VarChar(280)
  problemStatement String?      @map("problem_statement") @db.Text
  targetMarket    String?       @map("target_market") @db.Text
  workspaceStage  String?       @map("workspace_stage") @db.VarChar(50) // Idea | Validation | Building | Growth
  stage           ProjectStage   @default(Planning)
  status          ProjectStatus  @default(IdeaSubmitted) @map("status")
  progressPercent Int            @default(0) @map("progress_percent")
  budget          Decimal?       @db.Decimal(12, 2)
  startDate       DateTime?      @map("start_date") @db.Date
  deadline        DateTime?     @map("deadline") @db.Date
  repoUrl         String?       @map("repo_url")
  liveUrl         String?       @map("live_url")
  createdAt       DateTime      @default(now()) @map("created_at")
  updatedAt       DateTime      @updatedAt @map("updated_at")

  client          Client          @relation(fields: [clientId], references: [id], onDelete: Cascade)
  tasks           Task[]
  milestones      Milestone[]
  messages        Message[]
  files           File[]
  payments        Payment[]
  reports         MarketingReport[]
  maintenance     MaintenanceLog[]
  startupProfile  StartupProfile?
  campaigns       Campaign[]
  analyticsSnapshots MarketingAnalyticsSnapshot[]
  adminLead       AdminLead?
  ideaVaultItems  IdeaVaultItem[]
  businessModel   BusinessModel?
  projectMembers  ProjectMember[]
  aiConversations   AiConversation[]
  aiGeneratedOutputs AiGeneratedOutput[]
}

model Milestone {
  id        String         @id @default(uuid())
  projectId String         @map("project_id")
  title     String
  status    MilestoneStatus @default(Pending)
  dueDate   DateTime?      @map("due_date") @db.Date
  createdAt DateTime      @default(now()) @map("created_at")
  updatedAt DateTime      @updatedAt @map("updated_at")

  project Project @relation(fields: [projectId], references: [id], onDelete: Cascade)
  tasks   Task[]
}

model Task {
  id           String       @id @default(uuid())
  projectId    String       @map("project_id")
  milestoneId  String?      @map("milestone_id")
  assignedToId String?      @map("assigned_to_id")
  title        String
  description  String?      @db.Text
  status       TaskStatus   @default(Todo)
  priority     TaskPriority @default(Medium)
  dueDate      DateTime?    @map("due_date") @db.Date
  createdAt    DateTime     @default(now()) @map("created_at")
  updatedAt    DateTime     @updatedAt @map("updated_at")

  project   Project   @relation(fields: [projectId], references: [id], onDelete: Cascade)
  milestone Milestone? @relation(fields: [milestoneId], references: [id], onDelete: SetNull)
  assignedTo User?    @relation("AssignedTasks", fields: [assignedToId], references: [id], onDelete: SetNull)
}

model Message {
  id        String   @id @default(uuid())
  projectId String   @map("project_id")
  senderId  String   @map("sender_id")
  message   String   @db.Text
  createdAt DateTime @default(now()) @map("created_at")

  project Project @relation(fields: [projectId], references: [id], onDelete: Cascade)
  sender  User    @relation("SentMessages", fields: [senderId], references: [id], onDelete: Cascade)
}

model File {
  id         String   @id @default(uuid())
  projectId  String   @map("project_id")
  uploadedById String @map("uploaded_by_id")
  fileUrl    String   @map("file_url")
  fileType   String?  @map("file_type")
  category   String?  @db.VarChar(50) // pitch_deck | financial | legal | other
  createdAt  DateTime @default(now()) @map("created_at")

  project    Project @relation(fields: [projectId], references: [id], onDelete: Cascade)
  uploadedBy User    @relation("UploadedFiles", fields: [uploadedById], references: [id], onDelete: Cascade)
}

// Startup workspace: Idea Vault (notes, pitch drafts)
model IdeaVaultItem {
  id        String   @id @default(uuid())
  projectId String   @map("project_id")
  type      String   @db.VarChar(30) // note | pitch_draft
  title     String
  content   String   @db.Text
  status    String   @default("draft") @db.VarChar(30) // draft | submitted_for_review
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  project Project @relation(fields: [projectId], references: [id], onDelete: Cascade)
}

// Startup workspace: Business Model Canvas (one per project)
model BusinessModel {
  id               String   @id @default(uuid())
  projectId        String   @unique @map("project_id")
  valueProposition String?  @map("value_proposition") @db.Text
  customerSegments String?  @map("customer_segments") @db.Text
  revenueStreams   String?  @map("revenue_streams") @db.Text
  costStructure    String?  @map("cost_structure") @db.Text
  channels         String?  @db.Text
  keyActivities    String?  @map("key_activities") @db.Text
  createdAt        DateTime @default(now()) @map("created_at")
  updatedAt        DateTime @updatedAt @map("updated_at")

  project Project @relation(fields: [projectId], references: [id], onDelete: Cascade)
}

// Startup workspace: assigned team (founder = client owner; members = added by admin)
model ProjectMember {
  id        String   @id @default(uuid())
  projectId String   @map("project_id")
  userId    String   @map("user_id")
  role      String   @db.VarChar(30) // founder | member | viewer
  createdAt DateTime @default(now()) @map("created_at")

  project Project @relation(fields: [projectId], references: [id], onDelete: Cascade)
  user    User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([projectId, userId])
}

model Payment {
  id        String        @id @default(uuid())
  projectId String       @map("project_id")
  amount    Decimal      @db.Decimal(12, 2)
  status    PaymentStatus @default(Pending)
  dueDate   DateTime?    @map("due_date") @db.Date
  createdAt DateTime     @default(now()) @map("created_at")

  project Project @relation(fields: [projectId], references: [id], onDelete: Cascade)
}

model MarketingReport {
  id         String   @id @default(uuid())
  projectId  String   @map("project_id")
  metricType String   @map("metric_type")
  value      String
  date       DateTime @db.Date
  createdAt  DateTime @default(now()) @map("created_at")

  project Project @relation(fields: [projectId], references: [id], onDelete: Cascade)
}

model MaintenanceLog {
  id        String   @id @default(uuid())
  projectId String   @map("project_id")
  activity  String   @db.Text
  date      DateTime @db.Date
  createdAt DateTime @default(now()) @map("created_at")

  project Project @relation(fields: [projectId], references: [id], onDelete: Cascade)
}

// Agreement Signing Feature — digital document with tracked signatures
model Agreement {
  id          String   @id @default(uuid())
  title       String
  type        AgreementType
  templateUrl String?  @map("template_url")
  contentHtml String?  @map("content_html") @db.Text  // filled document content (no editing after any signature)
  createdById String?  @map("created_by")
  status      AgreementDocumentStatus @default(Pending) @map("status")  // Pending | Completed (all signed)
  version     Int      @default(1) @map("version")  // version control
  pdfHash     String?  @map("pdf_hash") @db.VarChar(64)  // SHA-256 of exported PDF for verification
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  createdBy   User?    @relation("AgreementCreatedBy", fields: [createdById], references: [id], onDelete: SetNull)
  assignedAgreements AssignedAgreement[]
  auditLogs          AgreementAuditLog[]
  hires              Hire[]
}

model AssignedAgreement {
  id          String                 @id @default(uuid())
  agreementId String                 @map("agreement_id")
  userId      String                 @map("user_id")
  role        String?                @map("role") @db.VarChar(80)  // signer type e.g. "Founder", "Investor"
  status      AssignedAgreementStatus @default(Pending)
  signedAt    DateTime?              @map("signed_at")
  signatureUrl String?              @map("signature_url")
  ipAddress   String?                @map("ip_address")
  deviceInfo  String?                @map("device_info") @db.VarChar(500)  // user agent / device
  deadline    DateTime?              @map("deadline") @db.Date
  createdAt   DateTime               @default(now()) @map("created_at")
  updatedAt   DateTime               @updatedAt @map("updated_at")

  agreement Agreement @relation(fields: [agreementId], references: [id], onDelete: Cascade)
  user      User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  auditLogs AgreementAuditLog[]
}

model AgreementAuditLog {
  id                  String   @id @default(uuid())
  agreementId         String   @map("agreement_id")
  assignedAgreementId String?  @map("assigned_agreement_id")
  userId              String   @map("user_id")
  action              String   // viewed | signed
  ipAddress           String?  @map("ip_address")
  createdAt           DateTime @default(now()) @map("created_at")

  agreement         Agreement          @relation(fields: [agreementId], references: [id], onDelete: Cascade)
  assignedAgreement AssignedAgreement? @relation(fields: [assignedAgreementId], references: [id], onDelete: Cascade)
}

// Investor Marketplace
enum StartupVisibilityStatus {
  draft
  pending_approval
  approved
  rejected
}

enum InvestmentStatus {
  expressed
  meeting_requested
  committed
  due_diligence
  agreement_signed
  completed
  withdrawn
}

// Access control for Investor Deal Room
enum DealRoomAccessStatus {
  requested
  approved
  rejected
}

model Investor {
  id                   String   @id @default(uuid())
  userId               String   @unique @map("user_id")
  name                 String
  email                String
  firmName             String?  @map("firm_name")
  investmentRangeMin   Decimal? @map("investment_range_min") @db.Decimal(12, 2)
  investmentRangeMax   Decimal? @map("investment_range_max") @db.Decimal(12, 2)
  industries           String?  @db.Text
  country              String?
  verified             Boolean  @default(false)
  createdAt            DateTime @default(now()) @map("created_at")
  updatedAt            DateTime @updatedAt @map("updated_at")

  user           User            @relation(fields: [userId], references: [id], onDelete: Cascade)
  investments    Investment[]
  dealRoomViews  DealRoomView[]
  savedStartups  SavedStartup[]
  dealRoomAccess DealRoomAccess[]
}

model StartupProfile {
  id                  String                 @id @default(uuid())
  projectId           String                 @unique @map("project_id")
  pitchSummary        String                 @map("pitch_summary") @db.Text
  tractionMetrics     String?                @map("traction_metrics") @db.Text
  fundingNeeded       Decimal                @map("funding_needed") @db.Decimal(12, 2)
  equityOffer         Decimal?               @map("equity_offer") @db.Decimal(5, 2)
  stage               String
  country             String?                @db.VarChar(100)
  liveUrl             String?                @map("live_url") @db.VarChar(500)
  repoUrl             String?                @map("repo_url") @db.VarChar(500)
  screenshots         Json?                  @db.JsonB // string[] URLs
  pitchDeckUrl        String?                @map("pitch_deck_url") @db.VarChar(500)
  aiFeasibilityScore  Int?                   @map("ai_feasibility_score") // 0-100
  aiRiskLevel         String?                @map("ai_risk_level") @db.VarChar(20) // Low | Medium | High
  aiMarketPotential   String?                @map("ai_market_potential") @db.VarChar(50)
  visibilityStatus    StartupVisibilityStatus @default(draft) @map("visibility_status")
  investorReady       Boolean                 @default(false) @map("investor_ready") // when true + approved → in Deal Room
  createdAt           DateTime               @default(now()) @map("created_at")
  updatedAt           DateTime               @updatedAt @map("updated_at")

  project       Project        @relation(fields: [projectId], references: [id], onDelete: Cascade)
  investments   Investment[]
  dealRoomViews DealRoomView[]
  savedStartups SavedStartup[]
  dealRoomAccess DealRoomAccess[]
}

model Investment {
  id             String           @id @default(uuid())
  investorId     String           @map("investor_id")
  startupId      String           @map("startup_id")
  amount         Decimal?         @db.Decimal(12, 2)
  equityPercent  Decimal?        @map("equity_percent") @db.Decimal(5, 2)
  status         InvestmentStatus @default(expressed)
  agreementId    String?          @map("agreement_id")
  meetingRequestedAt DateTime?    @map("meeting_requested_at")
  createdAt      DateTime        @default(now()) @map("created_at")
  updatedAt      DateTime        @updatedAt @map("updated_at")

  investor Investor       @relation(fields: [investorId], references: [id], onDelete: Cascade)
  startup  StartupProfile @relation(fields: [startupId], references: [id], onDelete: Cascade)
  messages DealRoomMessage[]
}

// Investor Deal Room: track views, saves, and messaging
model DealRoomView {
  id         String   @id @default(uuid())
  investorId String   @map("investor_id")
  startupId  String   @map("startup_id")
  viewedAt   DateTime @default(now()) @map("viewed_at")

  investor Investor       @relation(fields: [investorId], references: [id], onDelete: Cascade)
  startup  StartupProfile @relation(fields: [startupId], references: [id], onDelete: Cascade)

  @@unique([investorId, startupId])
  @@map("deal_room_views")
}

model SavedStartup {
  id         String   @id @default(uuid())
  investorId String   @map("investor_id")
  startupId  String   @map("startup_id")
  createdAt  DateTime @default(now()) @map("created_at")

  investor Investor       @relation(fields: [investorId], references: [id], onDelete: Cascade)
  startup  StartupProfile @relation(fields: [startupId], references: [id], onDelete: Cascade)

  @@unique([investorId, startupId])
  @@map("saved_startups")
}

model DealRoomMessage {
  id           String   @id @default(uuid())
  investmentId String   @map("investment_id")
  senderId     String   @map("sender_id")
  message      String   @db.Text
  createdAt    DateTime @default(now()) @map("created_at")

  investment Investment @relation(fields: [investmentId], references: [id], onDelete: Cascade)
  sender     User       @relation("DealRoomMessageSender", fields: [senderId], references: [id], onDelete: Cascade)

  @@map("deal_room_messages")
}

// Investor Deal Room: access requests and approvals
model DealRoomAccess {
  id         String              @id @default(uuid())
  investorId String              @map("investor_id")
  startupId  String              @map("startup_id")
  status     DealRoomAccessStatus @default(requested)
  createdAt  DateTime            @default(now()) @map("created_at")
  decidedAt  DateTime?           @map("decided_at")

  investor Investor       @relation(fields: [investorId], references: [id], onDelete: Cascade)
  startup  StartupProfile @relation(fields: [startupId], references: [id], onDelete: Cascade)

  @@unique([investorId, startupId])
  @@map("deal_room_access")
}

// Marketing Analytics & Campaign Engine
model Campaign {
  id         String    @id @default(uuid())
  projectId  String    @map("project_id")
  platform   String    // Meta | Google | Email
  budget     Decimal   @db.Decimal(12, 2)
  startDate  DateTime  @map("start_date") @db.Date
  endDate    DateTime  @map("end_date") @db.Date
  createdAt  DateTime  @default(now()) @map("created_at")
  updatedAt  DateTime  @updatedAt @map("updated_at")

  project Project @relation(fields: [projectId], references: [id], onDelete: Cascade)
  leads   Lead[]
}

model Lead {
  id                String   @id @default(uuid())
  campaignId        String   @map("campaign_id")
  source            String   // e.g. ad_set_1, newsletter_1
  cost              Decimal  @db.Decimal(12, 2)
  conversionStatus  String   @map("conversion_status") // lead | qualified | converted
  createdAt         DateTime @default(now()) @map("created_at")

  campaign Campaign @relation(fields: [campaignId], references: [id], onDelete: Cascade)
}

model MarketingAnalyticsSnapshot {
  id          String    @id @default(uuid())
  projectId   String    @map("project_id")
  traffic     Int       @default(0)
  conversions Int      @default(0)
  cac         Decimal?  @db.Decimal(12, 2)
  roi         Decimal?  @db.Decimal(8, 2)
  periodStart DateTime  @map("period_start") @db.Date
  periodEnd   DateTime  @map("period_end") @db.Date
  createdAt   DateTime  @default(now()) @map("created_at")

  project Project @relation(fields: [projectId], references: [id], onDelete: Cascade)
}

model ConsultationBooking {
  id                    String   @id @default(uuid())
  fullName              String   @map("full_name")
  email                 String
  country               String?
  businessIdea          String?  @map("business_idea") @db.Text
  stage                 String?  // Idea | MVP | Business
  mainGoal              String?  @map("main_goal") // Website | App | Marketing | Funding | All
  budgetRange           String?  @map("budget_range")
  preferredContactMethod String? @map("preferred_contact_method") // Email | WhatsApp | Zoom
  preferredDate         DateTime? @map("preferred_date") @db.Date
  preferredTime         String?  @map("preferred_time") // e.g. "09:00", "14:30"
  timezone              String?
  createdAt             DateTime @default(now()) @map("created_at")
}

model ContactMessage {
  id        String   @id @default(uuid())
  name      String
  email     String
  subject   String?
  message   String   @db.Text
  createdAt DateTime @default(now()) @map("created_at")
}

model EmailLog {
  id          String   @id @default(uuid())
  type        String   @map("type") // account_created, consultation_booked, idea_submitted, etc.
  toEmail     String   @map("to_email")
  subject     String
  status      String   @default("pending") // pending | sent | failed
  errorMessage String? @map("error_message") @db.Text
  sentAt     DateTime? @map("sent_at")
  metadata   Json?    // dynamicData for debugging
  createdAt   DateTime @default(now()) @map("created_at")
}

// In-app notifications (payment, approval, message, hiring, agreement, rating, etc.)
model Notification {
  id        String   @id @default(uuid())
  userId    String   @map("user_id")
  type      String   @db.VarChar(60) // payment, approval, message, hiring, agreement, rating, project_update
  title     String   @db.VarChar(200)
  message   String   @db.Text
  link      String?  @db.VarChar(500) // optional deep link
  read      Boolean  @default(false)
  createdAt DateTime @default(now()) @map("created_at")

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("notifications")
}

// AI Co-Founder: persistent chat per user/project
model AiConversation {
  id         String   @id @default(uuid())
  userId     String   @map("user_id")
  projectId  String?  @map("project_id")
  message    String   @db.Text
  role       String   @db.VarChar(20) // user | ai
  createdAt  DateTime @default(now()) @map("created_at")

  user    User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  project Project? @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@map("ai_conversations")
}

// AI Co-Founder: generated outputs (business model, roadmap, pricing, pitch, etc.)
model AiGeneratedOutput {
  id        String   @id @default(uuid())
  userId    String   @map("user_id")
  projectId String?  @map("project_id")
  type      String   @db.VarChar(60) // business_model | roadmap | pricing | pitch | marketing | idea_clarified | risk_analysis
  content   Json     @db.JsonB // structured or text
  createdAt DateTime @default(now()) @map("created_at")

  user    User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  project Project? @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@map("ai_generated_outputs")
}

// User-level payments (setup fee, etc.)
model UserPayment {
  id          String   @id @default(uuid())
  userId      String   @map("user_id")
  amount      Decimal  @db.Decimal(12, 2)
  currency    String   @db.VarChar(6) // USD, NGN, EUR, etc.
  type        String   @map("type") // setup_fee
  status      String   @default("pending") // pending | completed | failed | refunded
  reference   String?  @unique // gateway reference
  metadata    Json?    // gateway response, etc.
  createdAt   DateTime @default(now()) @map("created_at")
  completedAt DateTime? @map("completed_at")

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
}

// Admin Leads (track and manage incoming leads; convert to project)
enum AdminLeadStatus {
  New
  Contacted
  ProposalSent
  Converted
  Closed
}

model AdminLead {
  id           String          @id @default(uuid())
  name         String
  email        String
  country      String?
  ideaSummary  String?         @map("idea_summary") @db.Text
  stage        String?         // e.g. Idea | MVP | Business
  goal         String?         // e.g. Website | App | Marketing
  budget       String?         // e.g. range or amount
  status       AdminLeadStatus @default(New)
  assignedToId String?         @map("assigned_to_id")
  projectId    String?         @unique @map("project_id") // set when Converted
  createdAt    DateTime        @default(now()) @map("created_at")
  updatedAt    DateTime        @updatedAt @map("updated_at")

  assignedTo User?            @relation("AdminLeadsAssigned", fields: [assignedToId], references: [id], onDelete: SetNull)
  project    Project?         @relation(fields: [projectId], references: [id], onDelete: SetNull)
  notes      AdminLeadNote[]
}

model AdminLeadNote {
  id         String    @id @default(uuid())
  adminLeadId String   @map("admin_lead_id")
  content    String    @db.Text
  createdById String?  @map("created_by_id")
  createdAt  DateTime  @default(now()) @map("created_at")

  adminLead AdminLead @relation(fields: [adminLeadId], references: [id], onDelete: Cascade)
  createdBy User?      @relation(fields: [createdById], references: [id], onDelete: SetNull)
}

// Super Admin platform-wide audit (who did what, when)
model AuditLog {
  id          String   @id @default(uuid())
  adminId     String?  @map("admin_id")   // user who performed action; null for system
  actionType  String   @map("action_type") // e.g. login, idea_submitted, setup_skipped, agreement_signed
  entityType  String   @map("entity_type") // user | payment | agreement | project | idea | consultation | investment
  entityId    String?  @map("entity_id")
  details     Json?    // extra payload
  timestamp   DateTime @default(now()) @map("timestamp")

  admin User? @relation("AuditLogAdmin", fields: [adminId], references: [id], onDelete: SetNull)
}

// CMS: dynamic content editable by Super Admin (key-value by page)
model CmsContent {
  id          String   @id @default(uuid())
  key         String   @unique
  value       String   @db.Text
  type        String   @db.VarChar(30) // text | richtext | image | json
  page        String   @db.VarChar(80) // home | pricing | about | dashboard | legal | email | features | system
  updatedById String?  @map("updated_by_id")
  updatedAt   DateTime @updatedAt @map("updated_at")

  updatedBy User? @relation(fields: [updatedById], references: [id], onDelete: SetNull)

  @@map("cms_content")
}

// —— Hiring & Talent Marketplace ——
enum TalentStatus {
  pending
  approved
  rejected
}

enum HireStatus {
  requested
  agreement_sent
  signed
  in_progress
  completed
  cancelled
}

enum TalentAvailability {
  full_time
  part_time
  freelance
}

// Skills table (id, name, category) — CMS-editable; many-to-many with talents
model Skill {
  id         String        @id @default(uuid())
  name       String        @db.VarChar(120)
  category   String?       @db.VarChar(80) // Tech | Creative | Business
  createdAt  DateTime      @default(now()) @map("created_at")

  talentSkills TalentSkill[]
}

// Talent_Skills many-to-many
model TalentSkill {
  talentId   String   @map("talent_id")
  skillId    String   @map("skill_id")
  createdAt  DateTime @default(now()) @map("created_at")

  talent Talent @relation(fields: [talentId], references: [id], onDelete: Cascade)
  skill  Skill  @relation(fields: [skillId], references: [id], onDelete: Cascade)

  @@id([talentId, skillId])
  @@map("talent_skills")
}

model Talent {
  id              String             @id @default(uuid())
  userId          String             @unique @map("user_id")
  skills          String[]           // denormalized for filter; sync from TalentSkill or CMS list
  customRole      String?            @map("custom_role") @db.VarChar(120)
  roleCategory    String?            @map("role_category") @db.VarChar(100) // Tech / Creative / Business from CMS
  yearsExperience Int                @map("years_experience")
  portfolioUrl    String?            @map("portfolio_url") @db.VarChar(500)
  resumeUrl       String?            @map("resume_url") @db.VarChar(500)
  cvUrl           String?            @map("cv_url") @db.VarChar(500)
  pastProjects    Json?              @map("past_projects") @db.JsonB // [{ title, description, url? }]
  shortBio        String?            @map("short_bio") @db.Text
  availability    TalentAvailability? @map("availability")
  country         String?            @db.VarChar(100)
  phone           String?            @db.VarChar(50)
  services        Json?              @db.JsonB // [{ title, description, rate? }]
  skillRates      Json?              @map("skill_rates") @db.JsonB // { "Frontend": "50/hr", ... }
  videoUrl        String?            @map("video_url") @db.VarChar(500)
  hourlyRate      Decimal?           @map("hourly_rate") @db.Decimal(10, 2) // USD
  featured        Boolean            @default(false)   // admin can feature for marketplace
  hiddenByAdmin   Boolean            @default(false) @map("hidden_by_admin") // hide from marketplace
  status          TalentStatus       @default(pending)   // approved = true when status approved
  feePaid         Boolean            @default(false) @map("fee_paid") // marketplace_access
  averageRating   Decimal?           @map("average_rating") @db.Decimal(3, 2) // rating_avg 0–5
  ratingCount     Int                @default(0) @map("rating_count")
  createdAt       DateTime           @default(now()) @map("created_at")
  updatedAt       DateTime           @updatedAt @map("updated_at")
  approvedAt      DateTime?          @map("approved_at")
  approvedById    String?            @map("approved_by_id")

  user         User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  hires        Hire[]
  talentSkills TalentSkill[]
}

model Hirer {
  id                      String    @id @default(uuid())
  userId                  String    @unique @map("user_id")
  companyName             String    @map("company_name")
  website                 String?   @db.VarChar(500)
  verified                Boolean   @default(false) // verified_company after platform fee
  hiringNeeds             String?   @map("hiring_needs") @db.Text
  budget                  String?   @db.VarChar(100)
  feePaid                 Boolean   @default(false) @map("fee_paid")
  fairTreatmentSignedAt   DateTime? @map("fair_treatment_signed_at")
  fairTreatmentAgreementId String?  @map("fair_treatment_agreement_id")
  createdAt               DateTime @default(now()) @map("created_at")
  updatedAt               DateTime @updatedAt @map("updated_at")

  user         User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  hires        Hire[]
  jobRequests  JobRequest[]
}

model Hire {
  id                String     @id @default(uuid())
  talentId          String     @map("talent_id")
  hirerId            String     @map("hirer_id")
  projectTitle       String     @map("project_title")
  projectDescription String?   @map("project_description") @db.Text
  role               String?    @db.VarChar(120) // agreed role
  pay                String?    @db.VarChar(100) // agreed pay
  workTerms          Json?      @map("work_terms") @db.JsonB // terms text or structured
  agreementId        String?    @map("agreement_id")
  status             HireStatus @default(requested)
  createdAt          DateTime   @default(now()) @map("created_at")
  updatedAt          DateTime   @updatedAt @map("updated_at")
  completedAt       DateTime?  @map("completed_at")

  talent    Talent     @relation(fields: [talentId], references: [id], onDelete: Cascade)
  hirer     Hirer      @relation(fields: [hirerId], references: [id], onDelete: Cascade)
  agreement Agreement? @relation(fields: [agreementId], references: [id], onDelete: SetNull)
  ratings   TalentRating[]
}

// Partner With Us — investors, organizations, recruiters, agencies
model PartnerInquiry {
  id              String   @id @default(uuid())
  companyName     String   @map("company_name")
  website         String?  @db.VarChar(500)
  partnershipType String   @map("partnership_type") @db.VarChar(80) // Investor | Organization | Recruiter | Agency
  servicesOffered String?  @map("services_offered") @db.Text
  message         String   @db.Text
  contactEmail    String?  @map("contact_email")
  contactName     String?  @map("contact_name")
  createdAt       DateTime @default(now()) @map("created_at")

  @@map("partner_inquiries")
}

// Job requests posted by hiring companies (browse by talents)
model JobRequest {
  id          String   @id @default(uuid())
  hirerId     String   @map("hirer_id")
  title       String
  description String?  @db.Text
  roleCategory String? @map("role_category") @db.VarChar(100)
  skills      String[] // desired skills
  budget      String?  @db.VarChar(100)
  status      String   @default("open") @db.VarChar(30) // open | filled | closed
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  hirer Hirer @relation(fields: [hirerId], references: [id], onDelete: Cascade)
}

model TalentRating {
  id           String   @id @default(uuid())
  fromUserId   String   @map("from_user_id")
  toUserId     String   @map("to_user_id")
  hireId       String?  @map("hire_id")
  score        Int      // 1–5
  comment      String?  @db.Text
  skillRating  String?  @map("skill_rating") @db.VarChar(100) // optional skill tag for skill-based rating
  adminFlagged Boolean  @default(false) @map("admin_flagged") // fraud/moderation
  createdAt    DateTime @default(now()) @map("created_at")

  fromUser User  @relation("TalentRatingFrom", fields: [fromUserId], references: [id], onDelete: Cascade)
  toUser   User  @relation("TalentRatingTo", fields: [toUserId], references: [id], onDelete: Cascade)
  hire     Hire? @relation(fields: [hireId], references: [id], onDelete: SetNull)
}
